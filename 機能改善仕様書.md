# Journal英語学習アプリ - 機能改善仕様書

## 概要
本アプリは、日記（ジャーナル）を通じて自然に英語を学習できる革新的な語学学習アプリです。
ユーザーが日常的に日記を書くことで、実践的な英語力を身につけることができます。

## 主要機能改善内容

### 1. ミッション自動判定システム

#### 現在の仕様
- ユーザーが手動でミッションの完了をチェックする

#### 改善後の仕様
- 日記登録時に、システムが自動で条件を判定
- 判定基準：
  - **日記作成ミッション**: 日記が保存された時点で自動完了
  - **単語学習ミッション**: 新規単語を5個以上登録で完了
  - **連続記録ミッション**: 連続日数に応じて自動判定
  - **復習ミッション**: 学習画面で単語を10個以上復習で完了
  - **会話練習ミッション**: 100文字以上の日記作成で完了

#### 実装方針
```dart
// MissionService に自動判定メソッドを追加
Future<void> checkAndUpdateMissions({
  required DiaryEntry entry,
  required List<Word> newWords,
  required int reviewedWords,
}) async {
  // 各ミッションの条件をチェック
  // 条件を満たしていれば自動的に完了状態に更新
}
```

### 2. Lilyキャラクターの役割変更

#### 現在の仕様
- 励ましのメッセージを表示

#### 改善後の仕様
- **日記を書いた日**: 通常の励ましメッセージ
- **日記を書かなかった日**: 
  - カレンダーに「お休みマーク」を自動追加
  - 励ましのコメントを表示（例：「今日はお疲れ様でした。明日また頑張りましょう！」）
  - 連続記録が途切れないよう配慮したメッセージ

#### 実装方針
```dart
// LilyService に新機能を追加
Future<void> handleMissedDay(DateTime date) async {
  // カレンダーにお休みマークを追加
  // 励ましメッセージを生成
  // 連続記録の特別処理
}
```

### 3. ジャーナル画面のUI改善

#### 変更内容
- カレンダー下部の「日記を書く」ボタンを削除
- 右下のFloatingActionButtonのみで新規作成

### 4. 自動翻訳機能

#### 現在の仕様
- ユーザーが言語を選択して記入

#### 改善後の仕様
- 言語選択UIを削除
- 入力された言語を自動判定（英語/日本語）
- 反対側の言語に自動翻訳
- リアルタイムまたは入力完了後に翻訳

#### 実装方針
```dart
// TranslationService を拡張
class TranslationService {
  // 言語自動判定
  static String detectLanguage(String text) {
    // 英語と日本語の判定ロジック
  }
  
  // 自動翻訳
  static Future<String> autoTranslate(String text) async {
    final language = detectLanguage(text);
    // 適切な言語への翻訳
  }
}
```

### 5. インタラクティブ翻訳機能

#### 新機能
- 翻訳されたテキスト内の単語/フレーズをタップ可能に
- タップ時にツールチップで意味を表示
- 「単語帳に追加」ボタンを表示
- 追加された単語は学習画面で学習可能

#### UI仕様
```
[翻訳テキスト表示エリア]
- タップ可能な単語はアンダーライン表示
- タップ時にポップアップ表示：
  ┌─────────────────┐
  │ beautiful      │
  │ 美しい         │
  │ [単語帳に追加] │
  └─────────────────┘
```

### 6. 英語日記の添削機能

#### 新機能
- 英語で書かれた日記に対して：
  - 日本語訳を表示
  - 文法的な誤りがあれば添削を表示
  - より自然な表現の提案

#### 表示例
```
原文: I go to school yesterday.
訳文: 私は昨日学校に行きました。
添削: I went to school yesterday.
提案: "go" → "went" (過去形)
```

### 7. 学習画面の暗記カード機能

#### 現在の仕様
- フラッシュカード形式での表示

#### 改善後の仕様
- 登録した単語/フレーズを暗記カード形式で学習
- カードの表/裏：
  - 表面：英単語/フレーズ
  - 裏面：日本語の意味、例文、音声（将来実装）
- スワイプで次のカードへ
- 習熟度管理（覚えた/まだ覚えていない）

## 実装優先順位

1. **Phase 1**: 自動翻訳機能の実装
2. **Phase 2**: ミッション自動判定システム
3. **Phase 3**: インタラクティブ翻訳機能（単語タップ）
4. **Phase 4**: 学習画面の暗記カード機能
5. **Phase 5**: 英語添削機能
6. **Phase 6**: Lilyキャラクター機能改善

## 技術要件

### 翻訳API
- Google Translate API または DeepL API の導入
- オフライン時の対応検討

### データベース拡張
- 単語帳テーブルの追加
- 学習履歴の記録
- 添削履歴の保存

### UI/UXの考慮事項
- タップ可能エリアの明確化
- スムーズなアニメーション
- 直感的な操作性

## 期待される効果

1. **学習効率の向上**: 日記を書くだけで自動的に語彙が増える
2. **モチベーション維持**: Lilyのサポートで継続しやすい
3. **実践的な学習**: 自分の言葉で書いた内容が教材になる
4. **即座のフィードバック**: リアルタイム翻訳と添削

この仕様に基づいて、英語学習の新しいスタンダードとなるアプリを構築します。